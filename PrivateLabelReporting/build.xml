<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- WARNING: Eclipse auto-generated file.
              Any modifications will be overwritten.
              To include a user specific buildfile here, simply create one in the same
              directory with the processing instruction <?eclipse.ant.import?>
              as the first entry and export the buildfile again. -->
<project basedir="." default="build" name="PrivateLabelReporting">
    <property environment="env"/>
    <property name="ECLIPSE_HOME" value="../../eclipse"/>
    <property name="debuglevel" value="source,lines,vars"/>
    <property name="target" value="1.6"/>
    <property name="source" value="1.6"/>
    <path id="JUnit 4.libraryclasspath">
        <pathelement location="${ECLIPSE_HOME}/plugins/org.junit_4.8.2.v4_8_2_v20110321-1705/junit.jar"/>
        <pathelement location="${ECLIPSE_HOME}/plugins/org.hamcrest.core_1.1.0.v20090501071000.jar"/>
    </path>
    <path id="PrivateLabelReporting.classpath">
        <pathelement location="bin"/>
        <!--<path refid="JUnit 4.libraryclasspath"/>-->
        
    	<pathelement location="conf/log4j.properties"/>
    	<pathelement location="bin"/>
    	<!-- production and dev -->
    	
    	<pathelement location="PrivateLabelReporting.jar"/>
		
        <!--<pathelement location="/usr/share/java"/>-->
    	<pathelement location="/usr/share/java/ant.jar"/>
    	<pathelement location="/usr/share/java/ant-launcher.jar"/>
    	<pathelement location="/usr/share/java/commons-launcher.jar"/>
        <pathelement location="/usr/share/java/log4j.jar"/>
        <pathelement location="/usr/share/java/commons-logging.jar"/>
        <pathelement location="/usr/share/java/commons-lang.jar"/>
		<pathelement location="/usr/share/java/java3d"/>
		<pathelement location="/usr/share/java/java3d/j3dcore.jar"/>
		<pathelement location="/usr/share/java/java3d/j3dutils.jar"/>
		<pathelement location="/usr/share/java/java3d/vecmath.jar"/>
		<pathelement location="/usr/share/java/junit.jar"/>
		<pathelement location="/opt/tomcat/webapps/birt-viewer/WEB-INF/lib/jtds-1.2.5.jar"/>
    	<pathelement location="/opt/tomcat/webapps/birt-viewer/WEB-INF/lib/Helios.jar"/>
    </path>
	<pathconvert property="mf.classpath" pathsep=" ">
   	 	<path refid="PrivateLabelReporting.classpath" />
  	</pathconvert>
    <target name="init">
        <mkdir dir="bin"/>
        <copy includeemptydirs="false" todir="bin">
            <fileset dir="src">
                <exclude name="**/*.java"/>
            </fileset>
        </copy>
    </target>
    <target name="clean">
        <delete dir="bin"/>
    	<delete file="PrivateLabelReporting.jar"/>
    </target>
	<target name="reports">
			
			<mkdir dir="../../../MSAccess"/>
			<mkdir dir="../../../SQL"/>

			<!--
			<copy includeemptydirs="false" todir="../../../MSAccess" verbose="on">
	            <fileset dir="reports/MSAccess/">
	            </fileset>
	        </copy>
	        -->
			<copy includeemptydirs="false" todir="../../../SQL" verbose="on">
	            <fileset dir="reports/SQL/">
	            </fileset>
	        </copy>
		
		<mkdir dir="../../../lib"/>
		<copy includeemptydirs="false" todir="../../../lib" verbose="on">
			<fileset dir="reports/lib">
            </fileset>
		</copy>
	</target>
	<target name="ui" >
		
		<mkdir dir="../../../ui"/>
		<mkdir dir="../../../ui/images"/>
		<mkdir dir="../../../dashboards"/>
		<mkdir dir="../../../surveyQueues"/>

		
		
		<copy file="ui/objectives.jsp" todir="../../../" verbose="on" />
		<copy file="ui/index.jsp" todir="../../../" verbose="on" />
		<copy file="ui/testResults.jsp" todir="../../../" verbose="on" />
		<copy file="ui/faq.jsp" todir="../../../" verbose="on" />
		<copy file="ui/dashboards.jsp" todir="../../../" verbose="on" />
		<copy file="ui/help.jsp" todir="../../../" verbose="on" />
		<copy file="ui/doc.jsp" todir="../../../" verbose="on" />
		<copy file="ui/docmenu.jsp" todir="../../../" verbose="on" />
		
		<copy file="ui/dashboards/userList.jsp" todir="../../../dashboards/" verbose="on" />
		<copy file="ui/dashboards/userDashboard.jsp" todir="../../../dashboards/" verbose="on" />
		<copy file="ui/dashboards/reportView.jsp" todir="../../../dashboards/" verbose="on" />

		<copy file ="ui/surveyQueues.jsp"  todir="../../../" verbose="on" />
		<copy file ="ui/surveyQueues/surveyList.jsp"  todir="../../../surveyQueues/" verbose="on" />
		
		<copy file="ui/footer.jsp" todir="../../../ui" verbose="on" />
		<copy file="ui/menu.jsp" todir="../../../ui" verbose="on" />
		<copy file="ui/header.jsp" todir="../../../ui" verbose="on" />
		<copy file="ui/browserAssist.jsp" todir="../../../ui" verbose="on" />

		<copy includeemptydirs="false" todir="../../../ui/images" verbose="on">
			<fileset dir="ui/images">
            </fileset>
		</copy>
		

		
		<!--
		<copy includeemptydirs="false" todir="../../../dashboards" verbose="on">
			<fileset dir="dashboards">
            </fileset>
		</copy>
		-->
		
	</target>
	<target name="dashboardGenerator">
		<copy file="scripts/dashboardGeneration/genReport.new.sh" todir="../../../../../ReportEngine" verbose="on" />
		<chmod perm="a+x" file="../../../../../ReportEngine/genReport.new.sh"/>
	</target>
	<target name="crontab">
		<exec executable="/usr/bin/crontab" failonerror="true">
			<arg value="/opt/tomcat/webapps/birt-viewer/WEB-INF/lib/PrivateLabelReporting/conf/crontab"/>
		</exec>
		<echo message="Crontab updated, don't forget to uncomment your cronjobs." />
	</target>
	  <target name="javadoc" depends="build-project">
	  		<mkdir dir="doc/"/>
	        <javadoc access="private" author="true" destdir="doc" nodeprecated="false" nodeprecatedlist="false" noindex="false" nonavbar="false" notree="false" 
				packagenames="*" 
				source="1.6" sourcepath="src" splitindex="true" use="true" version="true" useexternalfile="true" >
				
				<classpath refid="PrivateLabelReporting.classpath"/>
				
				<link href="http://download.oracle.com/javase/6/docs/api/"/>
				<link href="http://jackcess.sourceforge.net/apidocs/"/>
				<link href="http://jxl.sourceforge.net/javadoc/"/>
			</javadoc>
	  </target>
	<target name="testsuite" depends="build-project">
		<java classname="test.HeliosTestSuite" failonerror="true" fork="yes">
			<classpath refid="PrivateLabelReporting.classpath"/>
		</java>
	</target>
	<target name="test" depends="build-project,jar">
		<junit failureProperty="test.failure">
      		<classpath refid="PrivateLabelReporting.classpath" />
			
			<!--two formatters, one for ant output, the other for the test files-->
			<formatter type="plain" usefile="false" />
			<formatter type="plain" usefile="true" extension="" />
			
			<!-- SQL Reports -->
			<!--
			
			
			-->
			<test name="test.report.output.IVRAgentCSATDetailTest" todir="test"/>
			<test name="test.report.output.RefundTotalsTest" todir="test"/>
			<test name="test.report.output.RefundCountTest" todir="test"/>
			<test name="test.report.output.TopRefundReasonsTest" todir="test"/>
			<test name="test.report.output.TopCaseDriversTest" todir="test"/>
			<test name="test.report.output.NoSaleDriversTest" todir="test"/>
			<test name="test.report.output.RealtimeSalesTest" todir="test"/>
			<test name="test.report.output.CallVolumeTest" todir="test"/>
			<test name="test.report.output.AverageOrderValueTest" todir="test"/>
			<test name="test.report.output.SalesCountTest" todir="test"/>
			<test name="test.report.output.IVRCSATTest" todir="test"/>
			<test name="test.report.output.ConversionTest" todir="test"/>
			<test name="test.report.output.LMICSATTest" todir="test"/>
			
			
    	</junit>
		<!--
		<copy includeemptydirs="true" todir="../../../test/">
        	<fileset dir="test">
        	</fileset>
        </copy>
        -->
    	<fail message="test failed" if="test.failure" />
	</target>
    <target depends="clean" name="cleanall"/>
    <target depends="build-subprojects,build-project,jar" name="build"/>
    <target name="build-subprojects"/>
    <target depends="init" name="build-project">
        <echo message="${ant.project.name}: ${ant.file}"/>
        <javac debug="true" debuglevel="${debuglevel}" destdir="bin" source="${source}" target="${target}" verbose="on">
            <src path="src"/>
            <classpath refid="PrivateLabelReporting.classpath"/>
        </javac>
    </target>
	<target name="jar" depends="build-project" >
		<jar description="Jar for Tomcat Deployment" destfile="PrivateLabelReporting.jar" basedir="bin" includes="**/*.class" >

			
			<fileset dir="conf"/>
			<fileset dir="lib"/>
			
    		<manifest>
    			<attribute name="Awesome" value="true"/>
     			<attribute name="Main-Class" value=""/>
				<attribute name="Class-Path" value="${mf.classpath}"/>
			</manifest>
  		</jar>
  	</target>
	
    <target description="Build all projects which reference this project. Useful to propagate changes." name="build-refprojects"/>
    <target description="copy Eclipse compiler jars to ant lib directory" name="init-eclipse-compiler">
        <copy todir="${ant.library.dir}">
            <fileset dir="${ECLIPSE_HOME}/plugins" includes="org.eclipse.jdt.core_*.jar"/>
        </copy>
        <unzip dest="${ant.library.dir}">
            <patternset includes="jdtCompilerAdapter.jar"/>
            <fileset dir="${ECLIPSE_HOME}/plugins" includes="org.eclipse.jdt.core_*.jar"/>
        </unzip>
    </target>
	<target name="tomcat-classes" depends="build">
		<mkdir dir="/opt/tomcat/shared/classes/ui"/>
		<copy todir ="/opt/tomcat/shared/classes/ui/" verbose="on">
			<fileset dir = "bin/ui">
				<include name="**/*.class"/>
			</fileset>
		</copy>
	</target>
	  <target name="forcedeploy" depends="build-project,jar,javadoc,reports,ui,tomcat-classes,dashboardGenerator,crontab">

	  	
			<copy includeemptydirs="true" todir="../../../doc_pl/">
	            <fileset dir="doc">
	        	</fileset>
	        </copy>
	  	<!--
			<copy includeemptydirs="true" todir="../../../test/">
	        	<fileset dir="test">
	        	</fileset>
	        </copy>
			-->
	  	
			<copy file="PrivateLabelReporting.jar" todir="../" verbose="on" />

			<copy file="lib/jackcess-1.2.1.jar" todir="../" verbose="on" />
	  		<copy file="/usr/share/java/log4j.jar" todir="../" verbose="on" />
			
			<exec executable="/opt/tomcat/webapps/birt-viewer/WEB-INF/lib/PrivateLabelReporting/scripts/tomcatRestart.pl" failonerror ="true"/>
  			<exec executable="/bin/touch" failonerror ="true" >
  				<arg value = "./log/reporting.log"/>
  			</exec>
			<exec executable="/bin/date" />
	  		
	  </target>
</project>
